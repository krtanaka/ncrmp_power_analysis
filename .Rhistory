# response_variable = "biomass"
response_variable = "coral_cover"
rowSums(df[,22:30])
summary(rowSums(df[,22:30]))
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
load("data/ALL_REA_FISH_RAW.rdata")
region = "MHI"
uku_or_not = T
# response_variable = "count"
# response_variable = "biomass"
response_variable = "coral_cover"
if (response_variable == "biomass") {
df = df %>%
subset(REGION == region) %>%
# mutate(response = BIOMASS_G_M2*0.001)
mutate(response = BIOMASS_G_M2)
} else {
df = df %>%
subset(REGION == region) %>%
mutate(response = COUNT*100)
}
load("data/BenthicCover_2010-2020_Tier1_SITE.RData") #live coral cover
region = "MHI"
uku_or_not = T
# response_variable = "count"
# response_variable = "biomass"
response_variable = "cover"
head(df)
glimpse(df)
df = df %>%
subset(REGION == region) %>%
mutate(response = CORAL*0.01)
summary(df$CORAL)
summary(df$response)
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
# Targets
# 4 functional groups
# live coral cover
# adult juvenile density
# Total numerical density estimates (individuals per 100 m2) were obtained by dividing fish counts in each survey by the survey area (353 m2 from two 15-m diameter survey cylinders) and multiplying by 100. - Nadon et al. 2020
region = "MHI"
uku_or_not = T
# response_variable = "fish_count"
# response_variable = "fish_biomass"
response_variable = "coral_cover"
load("data/ALL_REA_FISH_RAW.rdata")
unique(df$TROPHIC)
table(df$TROPHIC)
table(df$TROPHIC_MONREP)
load("data/BenthicCover_2010-2020_Tier1_SITE.RData") #live coral cover
glimpse(df)
names(df)
response_variable = "coral_cover"; sp = c("CCA", "CORAL", "EMA", "HAL", "I", "MA", "SC", "SED", "TURF")[2]
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
# Targets
# 4 functional groups
# live coral cover
# adult juvenile density
# Total numerical density estimates (individuals per 100 m2) were obtained by dividing fish counts in each survey by the survey area (353 m2 from two 15-m diameter survey cylinders) and multiplying by 100. - Nadon et al. 2020
region = "MHI"
uku_or_not = T
load("data/ALL_REA_FISH_RAW.rdata")
sp = df %>%
group_by(TAXONNAME) %>%
summarise(n = sum(response, na.rm = T)) %>%
mutate(freq = n/sum(n)) %>%
arrange(desc(freq)) %>%
top_n(5)
sp = df %>%
group_by(TAXONNAME) %>%
# summarise(n = sum(BIOMASS_G_M2, na.rm = T)) %>%
summarise(n = sum(COUNT, na.rm = T)) %>%
mutate(freq = n/sum(n)) %>%
arrange(desc(freq)) %>%
top_n(5)
df %>%
group_by(TAXONNAME) %>%
# summarise(n = sum(BIOMASS_G_M2, na.rm = T)) %>%
summarise(n = sum(COUNT, na.rm = T)) %>%
mutate(freq = n/sum(n)) %>%
arrange(desc(freq)) %>%
top_n(5)
load("data/ALL_REA_FISH_RAW.rdata")
df %>%
subset(REGION == region) %>%
group_by(TAXONNAME) %>%
# summarise(n = sum(BIOMASS_G_M2, na.rm = T)) %>%
summarise(n = sum(COUNT, na.rm = T)) %>%
mutate(freq = n/sum(n)) %>%
arrange(desc(freq)) %>%
top_n(5)
load("data/ALL_REA_FISH_RAW.rdata")
df %>%
subset(REGION == region) %>%
group_by(TAXONNAME) %>%
summarise(n = sum(BIOMASS_G_M2, na.rm = T)) %>%
# summarise(n = sum(COUNT, na.rm = T)) %>%
mutate(freq = n/sum(n)) %>%
arrange(desc(freq)) %>%
top_n(5)
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
# Targets
# 4 functional groups
# live coral cover
# adult juvenile density
# Total numerical density estimates (individuals per 100 m2) were obtained by dividing fish counts in each survey by the survey area (353 m2 from two 15-m diameter survey cylinders) and multiplying by 100. - Nadon et al. 2020
region = "MHI"
uku_or_not = T
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
# Targets
# 4 functional groups
# live coral cover
# adult juvenile density
# Total numerical density estimates (individuals per 100 m2) were obtained by dividing fish counts in each survey by the survey area (353 m2 from two 15-m diameter survey cylinders) and multiplying by 100. - Nadon et al. 2020
region = "MHI"
uku_or_not = T
# load("data/ALL_REA_FISH_RAW.rdata")
# df %>%
#   subset(REGION == region) %>%
#   group_by(TAXONNAME) %>%
#   summarise(n = sum(BIOMASS_G_M2, na.rm = T)) %>%
#   # summarise(n = sum(COUNT, na.rm = T)) %>%
#   mutate(freq = n/sum(n)) %>%
#   arrange(desc(freq)) %>%
#   top_n(5)
response_variable = "fish_count";      sp == ifelse(uku_or_not == T, "Aprion virescens", "Chromis vanderbilti")
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
# Targets
# 4 functional groups
# live coral cover
# adult juvenile density
# Total numerical density estimates (individuals per 100 m2) were obtained by dividing fish counts in each survey by the survey area (353 m2 from two 15-m diameter survey cylinders) and multiplying by 100. - Nadon et al. 2020
region = "MHI"
uku_or_not = T
# load("data/ALL_REA_FISH_RAW.rdata")
# df %>%
#   subset(REGION == region) %>%
#   group_by(TAXONNAME) %>%
#   summarise(n = sum(BIOMASS_G_M2, na.rm = T)) %>%
#   # summarise(n = sum(COUNT, na.rm = T)) %>%
#   mutate(freq = n/sum(n)) %>%
#   arrange(desc(freq)) %>%
#   top_n(5)
response_variable = "fish_count";      sp = ifelse(uku_or_not == T, "Aprion virescens", "Chromis vanderbilti")
uku_or_not = F
response_variable = "fish_count";      sp = ifelse(uku_or_not == T, "Aprion virescens", "Chromis vanderbilti")
load("data/ALL_REA_FISH_RAW.rdata")
df %>%
subset(REGION == region) %>%
# mutate(response = BIOMASS_G_M2*0.001)
mutate(response = BIOMASS_G_M2,
sp = sp)
df = df %>%
subset(REGION == region) %>%
# mutate(response = BIOMASS_G_M2*0.001)
mutate(response = BIOMASS_G_M2,
sp = sp)
load("data/ALL_REA_FISH_RAW.rdata")
glimpse(dfd)
glimpse(df)
load("data/ALL_REA_FISH_RAW.rdata")
df = df %>%
subset(REGION == region) %>%
# mutate(response = BIOMASS_G_M2*0.001)
mutate(response = BIOMASS_G_M2)
df$response = ifelse(df$TAXONNAME == sp, df$response, 0) # most abundant in MHI
load("data/ALL_REA_FISH_RAW.rdata")
df = df %>%
subset(REGION == region) %>%
mutate(response = COUNT*100)
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
# Targets
# 4 functional groups
# live coral cover
# adult juvenile density
# Total numerical density estimates (individuals per 100 m2) were obtained by dividing fish counts in each survey by the survey area (353 m2 from two 15-m diameter survey cylinders) and multiplying by 100. - Nadon et al. 2020
region = "MHI"
uku_or_not = F
# load("data/ALL_REA_FISH_RAW.rdata")
# df %>%
#   subset(REGION == region) %>%
response_variable = "fish_count";      sp = ifelse(uku_or_not == T, "Aprion virescens", "Chromis vanderbilti")
response_variable = "fish_biomass";    sp = ifelse(uku_or_not == T, "Aprion virescens", "Acanthurus olivaceus")
if (response_variable == "fish_biomass") {
load("data/ALL_REA_FISH_RAW.rdata")
df = df %>%
subset(REGION == region) %>%
# mutate(response = BIOMASS_G_M2*0.001)
mutate(response = BIOMASS_G_M2)
df$response = ifelse(df$TAXONNAME == sp, df$response, 0) # most abundant in MHI
}
if (response_variable == "fish_count") {
load("data/ALL_REA_FISH_RAW.rdata")
df = df %>%
subset(REGION == region) %>%
mutate(response = COUNT*100)
df$response = ifelse(df$TAXONNAME == sp, df$response, 0) # most abundant in MHI
}
response_variable
response_variable = "fish_count";      sp = ifelse(uku_or_not == T, "Aprion virescens", "Chromis vanderbilti")
response_variable = "fish_count";      sp = ifelse(uku_or_not == T, "Aprion virescens", "Chromis vanderbilti")
if (response_variable == "fish_count") {
load("data/ALL_REA_FISH_RAW.rdata")
df = df %>%
subset(REGION == region) %>%
mutate(response = COUNT*100)
df$response = ifelse(df$TAXONNAME == sp, df$response, 0) # most abundant in MHI
}
response_variable
load("data/ALL_REA_FISH_RAW.rdata")
df = df %>%
subset(REGION == region) %>%
mutate(response = COUNT*100)
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
# Targets
# 4 functional groups
# live coral cover
# adult juvenile density
# Total numerical density estimates (individuals per 100 m2) were obtained by dividing fish counts in each survey by the survey area (353 m2 from two 15-m diameter survey cylinders) and multiplying by 100. - Nadon et al. 2020
region = "MHI"
uku_or_not = F
response_variable = "fish_count";      sp = ifelse(uku_or_not == T, "Aprion virescens", "Chromis vanderbilti")
if (response_variable == "fish_count") {
load("data/ALL_REA_FISH_RAW.rdata")
df = df %>%
subset(REGION == region) %>%
mutate(response = COUNT*100)
df$response = ifelse(df$TAXONNAME == sp, df$response, 0) # most abundant in MHI
}
load("data/ALL_REA_FISH_RAW.rdata")
df = df %>%
subset(REGION == region) %>%
# mutate(response = BIOMASS_G_M2*0.001)
mutate(response = BIOMASS_G_M2)
df$response = ifelse(df$TAXONNAME == sp, df$response, 0) # most abundant in MHI
response_variable = "trophic_biomass"; sp = c("PISCIVORE", "PLANKTIVORE", "PRIMARY", "SECONDARY")[1]
response_variable
load("data/ALL_REA_FISH_RAW.rdata")
load("data/ALL_REA_FISH_RAW.rdata")
load("data/ALL_REA_FISH_RAW.rdata")
df = df %>%
subset(REGION == region) %>%
mutate(response = BIOMASS_G_M2)
df$response = ifelse(df$TROPHIC_MONREP == sp, df$response, 0)
print(sp)
load("data/BenthicCover_2010-2020_Tier1_SITE.RData") #live coral cover
df %>%
group_by(ISLAND) %>%
summarise(n = mean(response, na.rm = T),
lat = mean(LATITUDE)) %>%
arrange(desc(lat))
response_variable = "coral_cover";     sp = c("CCA", "CORAL", "EMA", "HAL", "I", "MA", "SC", "SED", "TURF")[2]
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
# Targets
# 4 functional groups
# live coral cover
# adult juvenile density
# Total numerical density estimates (individuals per 100 m2) were obtained by dividing fish counts in each survey by the survey area (353 m2 from two 15-m diameter survey cylinders) and multiplying by 100. - Nadon et al. 2020
region = "MHI"
uku_or_not = F
# load("data/ALL_REA_FISH_RAW.rdata")
# df %>%
#   subset(REGION == region) %>%
#   group_by(TAXONNAME) %>%
#   summarise(n = sum(BIOMASS_G_M2, na.rm = T)) %>%
#   # summarise(n = sum(COUNT, na.rm = T)) %>%
#   mutate(freq = n/sum(n)) %>%
#   arrange(desc(freq)) %>%
#   top_n(5)
response_variable = "fish_count";      sp = ifelse(uku_or_not == T, "Aprion virescens", "Chromis vanderbilti")
response_variable = "fish_biomass";    sp = ifelse(uku_or_not == T, "Aprion virescens", "Acanthurus olivaceus")
response_variable = "trophic_biomass"; sp = c("PISCIVORE", "PLANKTIVORE", "PRIMARY", "SECONDARY")[1]
response_variable = "coral_cover";     sp = c("CCA", "CORAL", "EMA", "HAL", "I", "MA", "SC", "SED", "TURF")[2]
response_variable = "coral_cover";     sp = c("CCA", "CORAL", "EMA", "HAL", "I", "MA", "SC", "SED", "TURF")[2]
if (response_variable == "fish_count") {
load("data/ALL_REA_FISH_RAW.rdata")
df = df %>%
subset(REGION == region) %>%
mutate(response = COUNT*100)
df$response = ifelse(df$TAXONNAME == sp, df$response, 0)
}
if (response_variable == "fish_biomass") {
load("data/ALL_REA_FISH_RAW.rdata")
df = df %>%
subset(REGION == region) %>%
# mutate(response = BIOMASS_G_M2*0.001)
mutate(response = BIOMASS_G_M2)
df$response = ifelse(df$TAXONNAME == sp, df$response, 0)
}
if (response_variable == "trophic_biomass") {
load("data/ALL_REA_FISH_RAW.rdata")
df = df %>%
subset(REGION == region) %>%
mutate(response = BIOMASS_G_M2)
df$response = ifelse(df$TROPHIC_MONREP == sp, df$response, 0)
}
if (response_variable == "coral_cover") {
load("data/BenthicCover_2010-2020_Tier1_SITE.RData") #live coral cover
df = df %>%
subset(REGION == region) %>%
mutate(response = CORAL*0.01)
}
df %>%
group_by(ISLAND) %>%
summarise(n = mean(response, na.rm = T),
lat = mean(LATITUDE)) %>%
arrange(desc(lat))
df %>%
group_by(ISLAND) %>%
summarise(n = mean(response, na.rm = T),
lat = mean(LATITUDE)) %>%
arrange(desc(lat)) %>%
ggplot(aes(lat, n, label = ISLAND)) +
geom_point()
df %>%
group_by(ISLAND) %>%
summarise(n = mean(response, na.rm = T),
lat = mean(LATITUDE)) %>%
arrange(desc(lat)) %>%
ggplot(aes(lat, n, label = ISLAND)) +
geom_point() +
geom_text()
df %>%
group_by(ISLAND) %>%
summarise(n = mean(response, na.rm = T),
lat = mean(LATITUDE)) %>%
arrange(desc(lat)) %>%
ggplot(aes(lat, n, label = ISLAND)) +
geom_text()
islands = c("Kauai", #1
"Lehua", #2
"Niihau", #3
"Kaula", #4
"Oahu", #5
"Molokai", #6
"Maui", #7
"Lanai", #8
"Molokini", #9
"Kahoolawe", #10
"Hawaii")[1:11]
df %>%
group_by(ISLAND) %>%
summarise(n = median(response, na.rm = T),
lat = mean(LATITUDE)) %>%
arrange(desc(lat)) %>%
ggplot(aes(lat, n, label = ISLAND)) +
geom_text()
df = df %>%
subset(ISLAND %in% islands) %>%
group_by(LONGITUDE, LATITUDE, ISLAND, OBS_YEAR, DATE_, DEPTH) %>%
summarise(response = median(response, na.rm = T))
df = df %>%
subset(ISLAND %in% islands) %>%
group_by(LONGITUDE, LATITUDE, ISLAND, OBS_YEAR, DATE_) %>%
summarise(response = median(response, na.rm = T))
hist(df$response)
summary(df$response)
zone <- (floor((df$LONGITUDE[1] + 180)/6) %% 60) + 1
xy_utm = as.data.frame(cbind(utm = project(as.matrix(df[, c("LONGITUDE", "LATITUDE")]), paste0("+proj=utm +units=km +zone=", zone))))
colnames(xy_utm) = c("X", "Y"); plot(xy_utm, pch = ".", bty = 'n')
df = cbind(df, xy_utm)
n_knots = 300
n_knots = 100 # a coarse mesh for speed
rea_spde <- make_mesh(df, c("X", "Y"), n_knots = n_knots, type = "cutoff_search")
islands = c("Kauai", #1
"Lehua", #2
"Niihau", #3
"Kaula", #4
"Oahu", #5
"Molokai", #6
"Maui", #7
"Lanai", #8
"Molokini", #9
"Kahoolawe", #10
"Hawaii")[5]
df = df %>%
subset(ISLAND %in% islands) %>%
group_by(LONGITUDE, LATITUDE, ISLAND, OBS_YEAR, DATE_) %>%
summarise(response = median(response, na.rm = T))
hist(df$response)
summary(df$response)
zone <- (floor((df$LONGITUDE[1] + 180)/6) %% 60) + 1
xy_utm = as.data.frame(cbind(utm = project(as.matrix(df[, c("LONGITUDE", "LATITUDE")]), paste0("+proj=utm +units=km +zone=", zone))))
colnames(xy_utm) = c("X", "Y"); plot(xy_utm, pch = ".", bty = 'n')
df = cbind(df, xy_utm)
n_knots = 300
n_knots = 100 # a coarse mesh for speed
rea_spde <- make_mesh(df, c("X", "Y"), n_knots = n_knots, type = "cutoff_search")
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
region = "MHI"
uku_or_not = F
response_variable = "fish_count";      sp = ifelse(uku_or_not == T, "Aprion virescens", "Chromis vanderbilti")
response_variable = "fish_biomass";    sp = ifelse(uku_or_not == T, "Aprion virescens", "Acanthurus olivaceus")
response_variable = "trophic_biomass"; sp = c("PISCIVORE", "PLANKTIVORE", "PRIMARY", "SECONDARY")[1]
response_variable = "coral_cover";     sp = c("CCA", "CORAL", "EMA", "HAL", "I", "MA", "SC", "SED", "TURF")[2]
if (response_variable == "fish_count") {
load("data/ALL_REA_FISH_RAW.rdata")
df = df %>%
subset(REGION == region) %>%
mutate(response = COUNT*100)
df$response = ifelse(df$TAXONNAME == sp, df$response, 0)
}
if (response_variable == "fish_biomass") {
load("data/ALL_REA_FISH_RAW.rdata")
df = df %>%
subset(REGION == region) %>%
# mutate(response = BIOMASS_G_M2*0.001)
mutate(response = BIOMASS_G_M2)
df$response = ifelse(df$TAXONNAME == sp, df$response, 0)
}
if (response_variable == "trophic_biomass") {
load("data/ALL_REA_FISH_RAW.rdata")
df = df %>%
subset(REGION == region) %>%
mutate(response = BIOMASS_G_M2)
df$response = ifelse(df$TROPHIC_MONREP == sp, df$response, 0)
}
if (response_variable == "coral_cover") {
load("data/BenthicCover_2010-2020_Tier1_SITE.RData") #live coral cover
df = df %>%
subset(REGION == region) %>%
mutate(response = CORAL*0.01)
}
df %>%
group_by(ISLAND) %>%
summarise(n = median(response, na.rm = T),
lat = mean(LATITUDE)) %>%
arrange(desc(lat)) %>%
ggplot(aes(lat, n, label = ISLAND)) +
geom_text()
# north-south gradient
df %>%
group_by(ISLAND) %>%
summarise(n = median(response, na.rm = T),
lat = mean(LATITUDE)) %>%
arrange(desc(lat)) %>%
ggplot(aes(lat, n, label = ISLAND)) +
geom_text()
islands = c("Kauai", #1
"Lehua", #2
"Niihau", #3
"Kaula", #4
"Oahu", #5
"Molokai", #6
"Maui", #7
"Lanai", #8
"Molokini", #9
"Kahoolawe", #10
"Hawaii")[5]
df = df %>%
subset(ISLAND %in% islands) %>%
group_by(LONGITUDE, LATITUDE, ISLAND, OBS_YEAR, DATE_) %>%
summarise(response = median(response, na.rm = T))
hist(df$response)
summary(df$response)
zone <- (floor((df$LONGITUDE[1] + 180)/6) %% 60) + 1
xy_utm = as.data.frame(cbind(utm = project(as.matrix(df[, c("LONGITUDE", "LATITUDE")]), paste0("+proj=utm +units=km +zone=", zone))))
colnames(xy_utm) = c("X", "Y"); plot(xy_utm, pch = ".", bty = 'n')
df = cbind(df, xy_utm)
n_knots = 300
n_knots = 100 # a coarse mesh for speed
rea_spde <- make_mesh(df, c("X", "Y"), n_knots = n_knots, type = "cutoff_search")
