library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
load("data/ALL_REA_FISH_RAW.rdata")
region = "MHI"
uku_or_not = F
# response_variable = "count"
response_variable = "biomass"
if (response_variable == "biomass") {
df = df %>%
subset(REGION == region) %>%
# mutate(density = BIOMASS_G_M2*0.001)
mutate(density = BIOMASS_G_M2)
} else {
df = df %>%
subset(REGION == region) %>%
mutate(density = COUNT*100)
}
sp = df %>%
# group_by(TAXONNAME) %>%
group_by(TROPHIC_MONREP) %>%
summarise(n = sum(density, na.rm = T)) %>%
mutate(freq = n/sum(n)) %>%
arrange(desc(freq)) %>%
top_n(5)
sp
if (uku_or_not == T) {
sp = "Aprion virescens"
df$density = ifelse(df$TAXONNAME == sp, df$density, 0)
} else {
sp = as.data.frame(sp[1,1]); sp = sp$TROPHIC_MONREP
df$density = ifelse(df$TROPHIC_MONREP == sp, df$density, 0) # most abundant in MHI
print(sp)
}
df %>%
group_by(ISLAND) %>%
summarise(n = mean(density, na.rm = T),
lat = mean(LATITUDE)) %>%
arrange(desc(lat))
islands = c("Kauai", #1
"Lehua", #2
"Niihau", #3
"Kaula", #4
"Oahu", #5
"Molokai", #6
"Maui", #7
"Lanai", #8
"Molokini", #9
"Kahoolawe", #10
"Hawaii")[1:11]
head(df)
df = df %>%
subset(ISLAND %in% islands) %>%
group_by(LONGITUDE, LATITUDE, DATE_, DEPTH) %>%
summarise(density = median(density, na.rm = T))
hist(df$density)
summary(df$density)
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
load("data/ALL_REA_FISH_RAW.rdata")
# Target
# 4 functional groups
# live coral cover
# adult juvenile density
# Total numerical density estimates (individuals per 100 m2) were obtained by dividing fish counts in each survey by the survey area (353 m2 from two 15-m diameter survey cylinders) and multiplying by 100. - Nadon et al. 2020
region = "MHI"
uku_or_not = F
# response_variable = "count"
response_variable = "biomass"
if (response_variable == "biomass") {
df = df %>%
subset(REGION == region) %>%
# mutate(density = BIOMASS_G_M2*0.001)
mutate(density = BIOMASS_G_M2)
} else {
df = df %>%
subset(REGION == region) %>%
mutate(density = COUNT*100)
}
sp = df %>%
# group_by(TAXONNAME) %>%
group_by(TROPHIC_MONREP) %>%
summarise(n = sum(density, na.rm = T)) %>%
mutate(freq = n/sum(n)) %>%
arrange(desc(freq)) %>%
top_n(5)
sp
if (uku_or_not == T) {
sp = "Aprion virescens"
df$density = ifelse(df$TAXONNAME == sp, df$density, 0)
} else {
sp = as.data.frame(sp[1,1]); sp = sp$TROPHIC_MONREP
df$density = ifelse(df$TROPHIC_MONREP == sp, df$density, 0) # most abundant in MHI
print(sp)
}
df %>%
group_by(ISLAND) %>%
summarise(n = mean(density, na.rm = T),
lat = mean(LATITUDE)) %>%
arrange(desc(lat))
islands = c("Kauai", #1
"Lehua", #2
"Niihau", #3
"Kaula", #4
"Oahu", #5
"Molokai", #6
"Maui", #7
"Lanai", #8
"Molokini", #9
"Kahoolawe", #10
"Hawaii")[1:11]
df = df %>%
subset(ISLAND %in% islands) %>%
group_by(LONGITUDE, LATITUDE, OBS_YEAR, DATE_, DEPTH) %>%
summarise(density = median(density, na.rm = T))
View(df)
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
load("data/ALL_REA_FISH_RAW.rdata")
# Target
# 4 functional groups
# live coral cover
# adult juvenile density
# Total numerical density estimates (individuals per 100 m2) were obtained by dividing fish counts in each survey by the survey area (353 m2 from two 15-m diameter survey cylinders) and multiplying by 100. - Nadon et al. 2020
region = "MHI"
uku_or_not = F
# response_variable = "count"
response_variable = "biomass"
if (response_variable == "biomass") {
df = df %>%
subset(REGION == region) %>%
# mutate(density = BIOMASS_G_M2*0.001)
mutate(density = BIOMASS_G_M2)
} else {
df = df %>%
subset(REGION == region) %>%
mutate(density = COUNT*100)
}
sp = df %>%
# group_by(TAXONNAME) %>%
group_by(TROPHIC_MONREP) %>%
summarise(n = sum(density, na.rm = T)) %>%
mutate(freq = n/sum(n)) %>%
arrange(desc(freq)) %>%
top_n(5)
sp
if (uku_or_not == T) {
sp = "Aprion virescens"
df$density = ifelse(df$TAXONNAME == sp, df$density, 0)
} else {
sp = as.data.frame(sp[1,1]); sp = sp$TROPHIC_MONREP
df$density = ifelse(df$TROPHIC_MONREP == sp, df$density, 0) # most abundant in MHI
print(sp)
}
df %>%
group_by(ISLAND) %>%
summarise(n = mean(density, na.rm = T),
lat = mean(LATITUDE)) %>%
arrange(desc(lat))
islands = c("Kauai", #1
"Lehua", #2
"Niihau", #3
"Kaula", #4
"Oahu", #5
"Molokai", #6
"Maui", #7
"Lanai", #8
"Molokini", #9
"Kahoolawe", #10
"Hawaii")[1:11]
df = df %>%
subset(ISLAND %in% islands) %>%
group_by(LONGITUDE, LATITUDE, OBS_YEAR, DEPTH) %>%
summarise(density = median(density, na.rm = T))
hist(df$density)
summary(df$density)
print(sp)
sp = as.data.frame(sp[3,1]); sp = sp$TROPHIC_MONREP
df$density = ifelse(df$TROPHIC_MONREP == sp, df$density, 0) # most abundant in MHI
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
load("data/ALL_REA_FISH_RAW.rdata")
# Target
# 4 functional groups
# live coral cover
# adult juvenile density
# Total numerical density estimates (individuals per 100 m2) were obtained by dividing fish counts in each survey by the survey area (353 m2 from two 15-m diameter survey cylinders) and multiplying by 100. - Nadon et al. 2020
region = "MHI"
uku_or_not = F
# response_variable = "count"
response_variable = "biomass"
if (response_variable == "biomass") {
df = df %>%
subset(REGION == region) %>%
# mutate(density = BIOMASS_G_M2*0.001)
mutate(density = BIOMASS_G_M2)
} else {
df = df %>%
subset(REGION == region) %>%
mutate(density = COUNT*100)
}
sp = df %>%
# group_by(TAXONNAME) %>%
group_by(TROPHIC_MONREP) %>%
summarise(n = sum(density, na.rm = T)) %>%
mutate(freq = n/sum(n)) %>%
arrange(desc(freq)) %>%
top_n(5)
sp
if (uku_or_not == T) {
sp = "Aprion virescens"
df$density = ifelse(df$TAXONNAME == sp, df$density, 0)
} else {
sp = as.data.frame(sp[3,1]); sp = sp$TROPHIC_MONREP
df$density = ifelse(df$TROPHIC_MONREP == sp, df$density, 0) # most abundant in MHI
print(sp)
}
df = df %>%
subset(ISLAND %in% islands) %>%
group_by(LONGITUDE, LATITUDE, OBS_YEAR, DATE_, DEPTH) %>%
summarise(density = median(density, na.rm = T))
hist(df$density)
summary(df$density)
df$density
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
load("data/ALL_REA_FISH_RAW.rdata")
# Target
# 4 functional groups
# live coral cover
# adult juvenile density
# Total numerical density estimates (individuals per 100 m2) were obtained by dividing fish counts in each survey by the survey area (353 m2 from two 15-m diameter survey cylinders) and multiplying by 100. - Nadon et al. 2020
region = "MHI"
uku_or_not = F
# response_variable = "count"
response_variable = "biomass"
if (response_variable == "biomass") {
df = df %>%
subset(REGION == region) %>%
# mutate(density = BIOMASS_G_M2*0.001)
mutate(density = BIOMASS_G_M2)
} else {
df = df %>%
subset(REGION == region) %>%
mutate(density = COUNT*100)
}
sp = df %>%
# group_by(TAXONNAME) %>%
group_by(TROPHIC_MONREP) %>%
summarise(n = sum(density, na.rm = T)) %>%
mutate(freq = n/sum(n)) %>%
arrange(desc(freq)) %>%
top_n(5)
sp
if (uku_or_not == T) {
sp = "Aprion virescens"
df$density = ifelse(df$TAXONNAME == sp, df$density, 0)
} else {
sp = as.data.frame(sp[3,1]); sp = sp$TROPHIC_MONREP
df$density = ifelse(df$TROPHIC_MONREP == sp, df$density, 0) # most abundant in MHI
print(sp)
}
df %>%
group_by(ISLAND) %>%
summarise(n = mean(density, na.rm = T),
lat = mean(LATITUDE)) %>%
arrange(desc(lat))
islands = c("Kauai", #1
"Lehua", #2
"Niihau", #3
"Kaula", #4
"Oahu", #5
"Molokai", #6
"Maui", #7
"Lanai", #8
"Molokini", #9
"Kahoolawe", #10
"Hawaii")[1:11]
df = df %>%
subset(ISLAND %in% islands) %>%
group_by(LONGITUDE, LATITUDE, OBS_YEAR, DATE_, DEPTH) %>%
summarise(density = median(density, na.rm = T))
View(df)
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
load("data/ALL_REA_FISH_RAW.rdata")
# Target
# 4 functional groups
# live coral cover
# adult juvenile density
# Total numerical density estimates (individuals per 100 m2) were obtained by dividing fish counts in each survey by the survey area (353 m2 from two 15-m diameter survey cylinders) and multiplying by 100. - Nadon et al. 2020
region = "MHI"
uku_or_not = F
# response_variable = "count"
response_variable = "biomass"
if (response_variable == "biomass") {
df = df %>%
subset(REGION == region) %>%
# mutate(density = BIOMASS_G_M2*0.001)
mutate(density = BIOMASS_G_M2)
} else {
df = df %>%
subset(REGION == region) %>%
mutate(density = COUNT*100)
}
sp = df %>%
# group_by(TAXONNAME) %>%
group_by(TROPHIC_MONREP) %>%
summarise(n = sum(density, na.rm = T)) %>%
mutate(freq = n/sum(n)) %>%
arrange(desc(freq)) %>%
top_n(5)
sp
if (uku_or_not == T) {
sp = "Aprion virescens"
df$density = ifelse(df$TAXONNAME == sp, df$density, 0)
} else {
sp = as.data.frame(sp[3,1]); sp = sp$TROPHIC_MONREP
df$density = ifelse(df$TROPHIC_MONREP == sp, df$density, 0) # most abundant in MHI
print(sp)
}
df %>%
group_by(ISLAND) %>%
summarise(n = mean(density, na.rm = T),
lat = mean(LATITUDE)) %>%
arrange(desc(lat))
islands = c("Kauai", #1
"Lehua", #2
"Niihau", #3
"Kaula", #4
"Oahu", #5
"Molokai", #6
"Maui", #7
"Lanai", #8
"Molokini", #9
"Kahoolawe", #10
"Hawaii")[1:11]
hist(df$density)
summary(df$density)
zone <- (floor((df$LONGITUDE[1] + 180)/6) %% 60) + 1
xy_utm = as.data.frame(cbind(utm = project(as.matrix(df[, c("LONGITUDE", "LATITUDE")]), paste0("+proj=utm +units=km +zone=", zone))))
colnames(xy_utm) = c("X", "Y"); plot(xy_utm, pch = ".", bty = 'n')
df = cbind(df, xy_utm)
n_knots = 300
n_knots = 100 # a coarse mesh for speed
rea_spde <- make_mesh(df, c("X", "Y"), n_knots = n_knots, type = "cutoff_search")
plot(rea_spde, pch = "."); axis(1); axis(2)
df$year = df$OBS_YEAR
df$depth = df$DEPTH
df$depth_scaled = scale(log(df$depth))
df$depth_scaled2 = df$depth_scaled ^ 2
plot(df$depth, df$density, pch = 20, bty = "n")
df = df %>%
subset(ISLAND %in% islands) %>%
group_by(LONGITUDE, LATITUDE, OBS_YEAR, DEPTH) %>%
summarise(density = sum(density, na.rm = T))
hist(df$density)
summary(df$density)
zone <- (floor((df$LONGITUDE[1] + 180)/6) %% 60) + 1
xy_utm = as.data.frame(cbind(utm = project(as.matrix(df[, c("LONGITUDE", "LATITUDE")]), paste0("+proj=utm +units=km +zone=", zone))))
colnames(xy_utm) = c("X", "Y"); plot(xy_utm, pch = ".", bty = 'n')
df = cbind(df, xy_utm)
n_knots = 300
n_knots = 100 # a coarse mesh for speed
rea_spde <- make_mesh(df, c("X", "Y"), n_knots = n_knots, type = "cutoff_search")
plot(rea_spde, pch = "."); axis(1); axis(2)
df$year = df$OBS_YEAR
df$depth = df$DEPTH
df$depth_scaled = scale(log(df$depth))
df$depth_scaled2 = df$depth_scaled ^ 2
plot(df$depth, df$density, pch = 20, bty = "n")
plot(df[9:11], pch = ".")
obs_year = unique(df$year)
full_year = seq(min(df$year), max(df$year), by = 1)
missing_year = setdiff(full_year, obs_year)
missing_year = as.integer(missing_year);missing_year
density_model <- sdmTMB(
data = df,
formula = density ~ as.factor(year) + depth_scaled + depth_scaled2,
silent = F,
# extra_time = missing_year,
spatial_trend = T,
spatial_only = F,
time = "year",
spde = rea_spde,
anisotropy = T,
family = tweedie(link = "log"),
control = sdmTMBcontrol(step.min = 0.01, step.max = 1)
)
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
load("data/ALL_REA_FISH_RAW.rdata")
# Target
# 4 functional groups
# live coral cover
# adult juvenile density
# Total numerical density estimates (individuals per 100 m2) were obtained by dividing fish counts in each survey by the survey area (353 m2 from two 15-m diameter survey cylinders) and multiplying by 100. - Nadon et al. 2020
region = "MHI"
uku_or_not = F
# response_variable = "count"
response_variable = "biomass"
setwd("C:/Users/Kisei.Tanaka/Desktop")
load("C:/Users/Kisei.Tanaka/Desktop/pcod.rda")
View(pcod)
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
load("data/ALL_REA_FISH_RAW.rdata")
# Target
# 4 functional groups
# live coral cover
# adult juvenile density
# Total numerical density estimates (individuals per 100 m2) were obtained by dividing fish counts in each survey by the survey area (353 m2 from two 15-m diameter survey cylinders) and multiplying by 100. - Nadon et al. 2020
region = "MHI"
uku_or_not = F
# response_variable = "count"
response_variable = "biomass"
if (response_variable == "biomass") {
df = df %>%
subset(REGION == region) %>%
# mutate(density = BIOMASS_G_M2*0.001)
mutate(density = BIOMASS_G_M2)
} else {
df = df %>%
subset(REGION == region) %>%
mutate(density = COUNT*100)
}
region = "MHI"
uku_or_not = F
# response_variable = "count"
response_variable = "biomass"
if (response_variable == "biomass") {
df = df %>%
subset(REGION == region) %>%
# mutate(density = BIOMASS_G_M2*0.001)
mutate(density = BIOMASS_G_M2)
} else {
df = df %>%
subset(REGION == region) %>%
mutate(density = COUNT*100)
}
sp = df %>%
# group_by(TAXONNAME) %>%
group_by(TROPHIC_MONREP) %>%
summarise(n = sum(density, na.rm = T)) %>%
mutate(freq = n/sum(n)) %>%
arrange(desc(freq)) %>%
top_n(5)
sp
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
load("data/ALL_REA_FISH_RAW.rdata")
# Target
# 4 functional groups
# live coral cover
# adult juvenile density
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
load("data/ALL_REA_FISH_RAW.rdata")
# Target
# 4 functional groups
# live coral cover
# adult juvenile density
library(sdmTMB)
library(dplyr)
library(ggplot2)
library(rgdal)
library(colorRamps)
rm(list = ls())
load("data/ALL_REA_FISH_RAW.rdata")
# Target
# 4 functional groups
# live coral cover
# adult juvenile density
